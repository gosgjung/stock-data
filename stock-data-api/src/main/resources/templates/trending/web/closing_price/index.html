<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>trending kospi and others</title>
    <script src="/static/assets/js/charts/zingchart.min.js"></script>
    <script src="/static/assets/js/charts/amcharts_4.5.16/amcharts4/core.js"></script>
    <script src="/static/assets/js/charts/amcharts_4.5.16/amcharts4/charts.js"></script>
    <script src="/static/assets/js/charts/amcharts_4.5.16/amcharts4/themes/material.js"></script>
    <script src="/static/assets/js/charts/amcharts_4.5.16/amcharts4/themes/animated.js"></script>
    <script src="/static/assets/js/charts/amcharts_4.5.16/amcharts4/lang/ko_KR.js"></script>
    <script src="/static/assets/js/date/moment.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
        }

        #myChart {
            width: 100%;
            height: 500px;
        }

    </style>
</head>
<body>
<div id="myChart" class="chart--container"></div>

</body>
<script th:inline="javascript">
	/*<![CDATA[*/
	var kospiResult = JSON.parse(/*[[${kospiResult}]]*/ null);
	var startDate = /*[[${startDate}]]*/ null;
	var endDate = /*[[${endDate}]]*/ null;
	/*]]>*/
    console.log(kospiResult);

    renderChart(kospiResult);

    function renderChart(sqlResult){
	    // Themes begin
	    am4core.useTheme(am4themes_animated);
	    // Themes end

	    // Create chart instance
	    var chart = am4core.create("myChart", am4charts.XYChart);

	    // Add data
	    chart.data = generateChartData();

	    // Create axes
	    var dateAxis = chart.xAxes.push(new am4charts.DateAxis());
	    dateAxis.renderer.minGridDistance = 50;

	    var valueAxisWon = chart.yAxes.push(new am4charts.ValueAxis());
	    valueAxisWon.title.dy = -10;
	    valueAxisWon.renderer.opposite = false;
	    valueAxisWon.title.fontWeight = 600;
	    valueAxisWon.title.fontSize = 14;
	    // valueAxisWon.title.paddingRight = 0;
	    // valueAxisWon.title.paddingBottom = 400;
	    valueAxisWon.tooltip.disabled = true;
	    valueAxisWon.title.text = "원";
	    valueAxisWon.title.rotation = 0;
	    valueAxisWon.title.align = "top";
	    valueAxisWon.renderer.grid.template.strokeOpacity = 0;
	    valueAxisWon.renderer.grid.template.disabled = true;

	    chart.yAxes.push(valueAxisWon);

	    // Create series
	    var seriesLineKospi = chart.series.push(new am4charts.LineSeries());
	    seriesLineKospi.dataFields.valueY = "kospi";
	    seriesLineKospi.dataFields.dateX = "date";
	    seriesLineKospi.strokeWidth = 2;                    // 선의 굵기
	    seriesLineKospi.minBulletDistance = 10;
        seriesLineKospi.stroke = am4core.color('#339af0');  // 선의 색상
        seriesLineKospi.fill = am4core.color('#339af0');    // 선의 내부
        seriesLineKospi.tensionX = 0.8;

	    seriesLineKospi.tooltipText = "kospi : {valueY.value} (원)";
	    seriesLineKospi.tooltip.pointerOrientation = "vertical";
	    seriesLineKospi.tooltip.getFillFromObject = false;
	    seriesLineKospi.tooltip.label.fill = am4core.color('#339af0');      // 툴팁 내부 폰트 색상
	    // seriesLineKospi.tooltip.background.fill = am4core.color('#339af0');
	    seriesLineKospi.tooltip.background.cornerRadius = 20;               // 툴팁 테두리 Radius
	    seriesLineKospi.tooltip.background.fillOpacity = 0.8;               // 툴팁 투명도
	    seriesLineKospi.tooltip.label.padding(12,12,12,12);

	    seriesLineKospi.yAxis = valueAxisWon;

	    // Add scrollbar
	    chart.scrollbarX = new am4charts.XYChartScrollbar();
	    chart.scrollbarX.series.push(seriesLineKospi);

	    // Add cursor
	    chart.cursor = new am4charts.XYCursor();
	    chart.cursor.xAxis = dateAxis;
	    // chart.cursor.snapToSeries = seriesLineKospi;

	    function generateChartData() {
	    	var chartData = [];

	    	sqlResult.forEach(function(obj, i){
                var date = new Date(obj.time+"");

                chartData.push({
                    date: date,
                    kospi: obj.kospi ? obj.kospi : null
                })
            });

	    	return chartData;
	    }
    }

</script>
</html>